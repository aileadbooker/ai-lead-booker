<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome Aboard - AI Lead Booker</title>
    <link rel="stylesheet" href="/css/onboarding.css">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>

<body>
    <div class="glass-orb orb-1"></div>
    <div class="glass-orb orb-2"></div>

    <div class="container">
        <h1>Welcome to the Family! ðŸŽ‰</h1>
        <p>Your account is active. Read the quick steps below to set up your first campaign correctly.</p>

        <div class="step">
            <h3><span>1</span> Connect Your Identity</h3>
            <p>Go to <strong>Settings > Email Connection</strong>. Enter your Google App Password to enable real-time
                replies.</p>
        </div>

        <div class="step">
            <h3><span>2</span> Define Your Niche</h3>
            <p>Be specific (e.g., "Real Estate Agents in Dallas") for best results.</p>
        </div>

        <div class="step">
            <h3><span>3</span> Launch & Relax</h3>
            <p>The AI will handle the rest. Check your calendar for bookings.</p>
        </div>

        <button id="finish-btn" class="btn-primary">
            Go to Dashboard <i class="fas fa-arrow-right"></i>
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const params = new URLSearchParams(window.location.search);
            if (params.has('session_id')) {
                console.log('Returned from checkout, verifying payment...');
                try {
                    await fetch('/api/checkout/success', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ session_id: params.get('session_id') })
                    });
                    // Clean up URL so refresh doesn't re-trigger
                    window.history.replaceState({}, document.title, window.location.pathname);
                } catch (e) {
                    console.error('Failed to verify session', e);
                }
            }
        });

        document.getElementById('finish-btn').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/onboarding/complete', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                    window.location.href = '/dashboard';
                } else {
                    alert('Error completing onboarding.');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });
    </script>
</body>

</html>